<!DOCTYPE html>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="datamaps.world.min.js"></script>
   
 
<script>
var csvdata = [];
//https://stackoverflow.com/questions/9491885/csv-to-array-in-d3-js
d3.csv("sucide_data.csv", function(data) {
  data.forEach(function(d) {
    d.year = +d.year;
    d["suicides/100k pop"] = +d["suicides/100k pop"];
    csvdata.push(d);
  });
  var dict = Filterdata(csvdata, 2000); 
});

//load csv -> filter through func(year, metric) -> output a json document 
function Filterdata(csvdata, year) {
  var contry_list_dict = new Map(csvdata.map(i => [i.Country_key, []]));

  var csvdataLength = csvdata.length;
  console.log(contry_list_dict["ALB"]);
    for (var i = 0; i < csvdataLength; i++) {
        if (year == csvdata[i].year) {
    		var cur_con = csvdata[i].Country_key;
    		console.log(cur_con);
    		console.log(contry_list_dict[cur_con]);
    		var list = contry_list_dict[cur_con];
    		console.log(list);
    		list.push(csvdata[i]["suicides/100k pop"]);
    		contry_list_dict[cur_con] = list;
		}
	}
		//[USA: [2.3, 5.6, 6.5]] in year 2000; .............
	for (var key in contry_list_dict){
  		var arr = contry_list_dict[key];
  		var sum = arr.reduce(function(a, b) { return a + b; });
        var avg = sum / arr.length;
        contry_list_dict[key] = avg;
	}
  return contry_list_dict;              
}
</script>

</body>
